
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="An infinitely extensible and reusable applications framework.">
      
      
      
      
        <link rel="prev" href="../io_provider/">
      
      
        <link rel="next" href="../register_widgets/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Register Functions - himena</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://unpkg.com/mermaid@8.0.0/dist/mermaid.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#register-functions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="himena" class="md-header__button md-logo" aria-label="himena" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            himena
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Register Functions
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/hanjinliu/himena" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    himena
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="himena" class="md-nav__button md-logo" aria-label="himena" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    himena
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hanjinliu/himena" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    himena
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../usage/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/tab_and_window/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tab/Window Manipulation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workflows
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/sessions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sessions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/customization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Customization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/builtin_widgets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Built-in Widgets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/builtin_dock_widgets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Built-in Dock Widgets
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Developer's Guide
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Developer's Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../widget_data_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The WidgetDataModel Standard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plugin_system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plugin System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io_provider/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reader/Writer Functions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Register Functions
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Register Functions
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#function-definition" class="md-nav__link">
    <span class="md-ellipsis">
      Function Definition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependency-injection-and-type-narrowing" class="md-nav__link">
    <span class="md-ellipsis">
      Dependency Injection and Type Narrowing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#place-the-function-in-any-places-in-menu-bar" class="md-nav__link">
    <span class="md-ellipsis">
      Place the Function in Any Places in Menu Bar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parametric-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Parametric Functions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-parameter-input-window" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Parameter Input Window
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bind-values-to-parameter-input" class="md-nav__link">
    <span class="md-ellipsis">
      Bind Values to Parameter Input
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preview-function-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      Preview Function Outputs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asynchronous-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Asynchronous Execution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions-that-only-works-in-a-specific-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Functions That Only Works in A Specific Widget
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../register_widgets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Register Widgets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../register_dock_widgets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Register Dock Widgets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../drag_and_drop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Drag and Drop
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plotting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plotting in Himena
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/consts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    himena.consts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/layout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    himena.layout
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/profile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    himena.profile
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/plugins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    himena.plugins
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    himena.types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/standards/model_meta/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    himena.standards.model_meta
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/standards/plotting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    himena.standards.plotting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/standards/roi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    himena.standards.roi
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/widgets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    himena.widgets
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#function-definition" class="md-nav__link">
    <span class="md-ellipsis">
      Function Definition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependency-injection-and-type-narrowing" class="md-nav__link">
    <span class="md-ellipsis">
      Dependency Injection and Type Narrowing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#place-the-function-in-any-places-in-menu-bar" class="md-nav__link">
    <span class="md-ellipsis">
      Place the Function in Any Places in Menu Bar
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parametric-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Parametric Functions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-parameter-input-window" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Parameter Input Window
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bind-values-to-parameter-input" class="md-nav__link">
    <span class="md-ellipsis">
      Bind Values to Parameter Input
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preview-function-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      Preview Function Outputs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asynchronous-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Asynchronous Execution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions-that-only-works-in-a-specific-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Functions That Only Works in A Specific Widget
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="register-functions">Register Functions</h1>
<p>To process and analyze data, you need functions that convert an object into another.
This section tells you how to register such functions so that you can run them on the
GUI.</p>
<h2 id="function-definition">Function Definition</h2>
<p>Basically, a function that processes data is a function that takes a <code>WidgetDataModel</code>
object and returns another <code>WidgetDataModel</code> object. For example, the following function
formats a non-indented json text data into an indented, pretty json text data.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">himena</span><span class="w"> </span><span class="kn">import</span> <span class="n">WidgetDataModel</span>

<span class="k">def</span><span class="w"> </span><span class="nf">format_json</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">WidgetDataModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WidgetDataModel</span><span class="p">:</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">WidgetDataModel</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Because <code>himena</code> has its default widget for <code>"text"</code>-type model, this function can be
readly used in the GUI. You can register this function using <code>register_function()</code>
function.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">himena</span><span class="w"> </span><span class="kn">import</span> <span class="n">WidgetDataModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">himena.plugins</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_function</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="hll"><span class="nd">@register_function</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Format JSON Text&quot;</span><span class="p">)</span>
</span><span class="k">def</span><span class="w"> </span><span class="nf">format_json</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">WidgetDataModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WidgetDataModel</span><span class="p">:</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">WidgetDataModel</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</code></pre></div>
<p>The registered function will be shown in the menu bar (under the "Plugins" menu by
default) and the command palette. When this function is called from the GUI, currently
active window will be converted into a <code>WidgetDataModel</code> object and passed to the
function. The returned <code>WidgetDataModel</code> object will then be converted into another
window.</p>
<details class="running functions without registered widget">
<summary>Running</summary>
<p>Because all the internal data is stored in <code>WidgetDataModel</code> objects, you can even
run functions without registered widgets.</p>
</details>
<hr />
<h2 id="dependency-injection-and-type-narrowing">Dependency Injection and Type Narrowing</h2>
<p><code>himena</code> uses <a href="https://github.com/pyapp-kit/in-n-out"><code>in_n_out</code></a> library to inject
the application context into functions. For example, in the previous example, the
<code>WidgetDataModel</code> of the current window is injected to the <code>model</code> argument of the
<code>format_json</code> function. If no window is activated, the "Format JSON Text" menu is grayed
out.</p>
<p>Here are the list of type hints that will be provided to the argument of the registered
functions.</p>
<ul>
<li><a class="autorefs autorefs-internal" href="../../api/types/#himena.types.WidgetDataModel"><code>WidgetDataModel</code></a>: The current window's data.</li>
<li><a class="autorefs autorefs-internal" href="../../api/widgets/#himena.widgets.TabArea"><code>TabArea</code></a>: The current tab area.</li>
<li><a class="autorefs autorefs-internal" href="../../api/widgets/#himena.widgets.SubWindow"><code>SubWindow</code></a>: The current sub-window.</li>
<li><a class="autorefs autorefs-internal" href="../../api/widgets/#himena.widgets.MainWindow"><code>MainWindow</code></a>: The main window.</li>
<li><a class="autorefs autorefs-internal" href="../../api/types/#himena.types.ClipboardDataModel"><code>ClipboardDataModel</code></a>: The clipboard data.</li>
</ul>
<p>And here are the list of return types that will be processed.</p>
<ul>
<li><a class="autorefs autorefs-internal" href="../../api/types/#himena.types.WidgetDataModel"><code>WidgetDataModel</code></a>: The returned value will be added to the current tab.</li>
<li><code>list[WidgetDataModel]</code>: Each item will be added to the current tab.</li>
<li><a class="autorefs autorefs-internal" title="Parametric = NewType('Parametric', Any)

  
      module-attribute
  " href="../../api/types/#himena.types.Parametric"><code>Parametric</code></a>: The returned function will be converted into a GUI for user input of
  parameters (see <a href="#parametric-functions">here</a>).</li>
<li><a class="autorefs autorefs-internal" href="../../api/types/#himena.types.ClipboardDataModel"><code>ClipboardDataModel</code></a>: The returned data will overwrite the system clipboard.</li>
<li><a class="autorefs autorefs-internal" title="WidgetConstructor = NewType('WidgetConstructor', object)

  
      module-attribute
  " href="../../api/types/#himena.types.WidgetConstructor"><code>WidgetConstructor</code></a>: The returned function will be executed to add a new sub-window with the constructed widget.</li>
<li><a href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future"><code>concurrent.Future</code></a>: The returned job will be executed asynchronously.</li>
</ul>
<p>A problem of the example above is that the <code>model</code> argument may contain any type of
data (not only <code>"text"</code>-type data). To narrow the type of data, you can use the <code>types</code>
argument of the <code>register_function()</code> decorator.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">himena.consts</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardType</span>

<span class="nd">@register_function</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Format JSON Text&quot;</span><span class="p">,</span>
<span class="hll">    <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="n">StandardType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">],</span>
</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">format_json</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">WidgetDataModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WidgetDataModel</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>
<p>With this, the "Format JSON Text" menu will be enabled only if the current window is a
widget for <code>"text"</code>-type data. Another benefit is that this command will be added to the
<a href="../../tutorial/#model-menu-button">model menu</a> of the <code>"text"</code>-type widget.</p>
<hr />
<h2 id="place-the-function-in-any-places-in-menu-bar">Place the Function in Any Places in Menu Bar</h2>
<p>The place to put the function in the menu bar can be specified by the <code>menus</code> argument
of the <code>register_function()</code> decorator. Each menu is specified by a "/"-separated string
identifier. Following is an example that puts the function in the
"my-plugins &gt; my-text-plugins" menu.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">himena</span><span class="w"> </span><span class="kn">import</span> <span class="n">WidgetDataModel</span><span class="p">,</span> <span class="n">StandardType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">himena.plugins</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_function</span>

<span class="nd">@register_function</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Format JSON Text&quot;</span><span class="p">,</span>
    <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="n">StandardType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">],</span>
<span class="hll">    <span class="n">menus</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;my-plugins/my-text-plugins&quot;</span><span class="p">],</span>
</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">format_json</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">WidgetDataModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WidgetDataModel</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>
<p>To define how to display the menu title, you can use <a class="autorefs autorefs-internal" title="configure_submenu(submenu_id, title=None, *, group=None, order=None)" href="../../api/plugins/#himena.plugins.configure_submenu"><code>configure_submenu()</code></a>.</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="kn">from</span><span class="w"> </span><span class="nn">himena.plugins</span><span class="w"> </span><span class="kn">import</span> <span class="n">configure_submenu</span>
</span>
<span class="n">configure_submenu</span><span class="p">(</span><span class="s2">&quot;my-plugins&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;My Plugins&quot;</span><span class="p">)</span>
<span class="n">configure_submenu</span><span class="p">(</span><span class="s2">&quot;my-plugins/my-text-plugins&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;My Text Plugins&quot;</span><span class="p">)</span>
</code></pre></div>
<p>If a menu has many items, it is better to group them. You can use the <code>group</code> argument
of <code>configure_submenu()</code> for this purpose. Groups are sorted alphabetically, so it is
a good idea to prefix the group name with a number to control the order.</p>
<div class="highlight"><pre><span></span><code><span class="n">configure_submenu</span><span class="p">(</span>
    <span class="s2">&quot;my-plugins/my-text-plugins&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;My Text Plugins&quot;</span><span class="p">,</span>
<span class="hll">    <span class="n">group</span><span class="o">=</span><span class="s2">&quot;00_process-text&quot;</span><span class="p">,</span>
</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="parametric-functions">Parametric Functions</h2>
<p>Many functions require user parameter inputs. It is very easy to implement a parametric
function in Python: just add more arguments to the function. However, implementing
parametric functions in GUI is usually tedious, as you need to create a specific
widget for every function.</p>
<p><code>himena</code> uses <a href="https://github.com/pyapp-kit/magicgui"><code>magicgui</code></a> package to convert a
function with parameters into a GUI widget based on the type hints of the function.
Therefore, <strong>you can easily register a parametric function just by returning a function</strong>
that takes parameters.</p>
<p>To tell <code>himena</code> that the returned value should be converted into a GUI for user input
of parameters, you need to <strong>annotate the returned value with the <code>Parametric</code> type</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">himena.plugins</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_function</span>
<span class="hll"><span class="kn">from</span><span class="w"> </span><span class="nn">himena</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parametric</span><span class="p">,</span> <span class="n">StandardType</span><span class="p">,</span> <span class="n">WidgetDataModel</span>
</span>
<span class="nd">@register_function</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Format JSON Text&quot;</span><span class="p">,</span>
    <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="n">StandardType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">],</span>
<span class="p">)</span>
<span class="hll"><span class="k">def</span><span class="w"> </span><span class="nf">format_json</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">WidgetDataModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Parametric</span><span class="p">:</span>
</span>    <span class="k">def</span><span class="w"> </span><span class="nf">run_format_json</span><span class="p">(</span><span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">WidgetDataModel</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">run_format_json</span>
</code></pre></div>
<p>The type-to-widget mapping is as follows:</p>
<ul>
<li><code>int</code>, <code>float</code>, <code>str</code>, <code>list[int]</code>, <code>list[float]</code> &rarr; Line edit with the
  corresponding type.</li>
<li><code>bool</code> &rarr; Toggle switch.</li>
<li><code>enum.Enum</code>, <code>typing.Literal</code> &rarr; Combo box with the choices.</li>
<li><code>pathlib.Path</code> &rarr; Entry with a file dialog button.</li>
<li><code>tuple</code> &rarr; Group box with the corresponding types.</li>
<li><code>WidgetDataModel</code>, <code>list[WidgetDataModel]</code>, <code>SubWindow</code>, <code>list[SubWindow]</code>
  &rarr; Drop area that can drop other sub-windows to provide the corresponding data.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Serialization</p>
<p>The input parameters should be serializable for <a href="../../usage/workflows/">workflow</a>
recording. Although <code>magicgui</code> can support various type-to-widget mapping, the input
values are restricted to those that can be serialized by <code>himena</code>. For example,
<code>slice</code> and <code>range</code> objects are not supported as input types in <code>himena</code>.</p>
</div>
<hr />
<h2 id="configure-parameter-input-window">Configure Parameter Input Window</h2>
<p>The parameter input window is automatically generated by <code>magicgui</code>. You can further
customize its appearance and GUI properties by <a class="autorefs autorefs-internal" title="configure_gui(f=None, *, title=None, preview=False, auto_close=True, show_parameter_labels=True, gui_options=None, result_as='window', **kwargs)" href="../../api/plugins/#himena.plugins.configure_gui"><code>configure_gui()</code></a>
decorator.</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="kn">from</span><span class="w"> </span><span class="nn">himena.plugins</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_function</span><span class="p">,</span> <span class="n">configure_gui</span>
</span><span class="kn">from</span><span class="w"> </span><span class="nn">himena</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parametric</span><span class="p">,</span> <span class="n">StandardType</span><span class="p">,</span> <span class="n">WidgetDataModel</span>

<span class="nd">@register_function</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Format JSON Text&quot;</span><span class="p">,</span>
    <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="n">StandardType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">],</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">format_json</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">WidgetDataModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Parametric</span><span class="p">:</span>
<span class="hll">    <span class="nd">@configure_gui</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Indent in Spaces&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>
</span>    <span class="k">def</span><span class="w"> </span><span class="nf">run_format_json</span><span class="p">(</span><span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">WidgetDataModel</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">run_format_json</span>
</code></pre></div>
<p><code>configure_gui</code> takes keyword arguments that are passed to the function it decorates,
and use <code>dict</code> to configure the widget used for the parameter input.</p>
<p>Here's some of the options you can use.</p>
<ul>
<li><code>label</code>: The label of the input field.</li>
<li><code>value</code>: The default value.</li>
<li><code>choices</code>: List of choices.</li>
<li><code>widget_type</code>: Widget class to use. This option must be a <a href="https://pyapp-kit.github.io/magicgui/widgets/"><code>magicgui</code> ValueWidget</a>.</li>
<li><code>min</code>: The minimum value (if applicable).</li>
<li><code>max</code>: The maximum value (if applicable).</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To avoid argument name collision, you can pass the options as a dict to
<code>gui_options</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@configure_gui</span><span class="p">(</span>
    <span class="n">gui_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;indent&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Indent in Spaces&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}},</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">run_format_json</span><span class="p">(</span><span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">):</span>
    <span class="o">...</span>
</code></pre></div>
</div>
<hr />
<h2 id="bind-values-to-parameter-input">Bind Values to Parameter Input</h2>
<p>Some parameters are better to be retrieved from the input sub-window. For example, if
a function counts the number of "a"s in a subset of a text, the user may want to
select the text in the sub-window and pass the selected range to the function instead of
requesting a range (int, int) using a parameter input.</p>
<p>The "bind" option of <code>magicgui</code> is very useful for this purpose. The value passed to the
"bind" option will be directly used as the value for the parameter. Because the selected
range is available in the <a class="autorefs autorefs-internal" href="../../api/standards/model_meta/#himena.standards.model_meta.TextMeta"><code>TextMeta</code></a> metadata
as the <code>selection</code> property, you can define a function as follows.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">himena.plugins</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_function</span><span class="p">,</span> <span class="n">configure_gui</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">himena</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parametric</span><span class="p">,</span> <span class="n">StandardType</span><span class="p">,</span> <span class="n">WidgetDataModel</span>

<span class="nd">@register_function</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Count &#39;a&#39;&quot;</span><span class="p">,</span>
    <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="n">StandardType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">],</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">count_a</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">WidgetDataModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Parametric</span><span class="p">:</span>
<span class="hll">    <span class="nd">@configure_gui</span><span class="p">(</span><span class="n">text_range</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bind&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">selection</span><span class="p">})</span>
</span>    <span class="k">def</span><span class="w"> </span><span class="nf">run_count_a</span><span class="p">(</span><span class="n">text_range</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">text_range</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">run_count_a</span>
</code></pre></div>
<p>This function does not have any parameter that can be specified by the user, thus no
parameter input widget will be shown. The function will be immediately called when the
command menu is clicked.</p>
<p>If the function has other parameters that do not have bound values, the parameter input
widget will be shown as usual.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">himena.plugins</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_function</span><span class="p">,</span> <span class="n">configure_gui</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">himena</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parametric</span><span class="p">,</span> <span class="n">StandardType</span><span class="p">,</span> <span class="n">WidgetDataModel</span>

<span class="nd">@register_function</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Count &#39;a&#39;&quot;</span><span class="p">,</span>
    <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="n">StandardType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">],</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">count_a_2</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">WidgetDataModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Parametric</span><span class="p">:</span>
    <span class="nd">@configure_gui</span><span class="p">(</span><span class="n">text_range</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;bind&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">selection</span><span class="p">})</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_count_a</span><span class="p">(</span><span class="n">text_range</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">text_range</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">case_sensitive</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">run_count_a</span>
</code></pre></div>
<details class="note">
<summary>Why do we ever need to bind values?</summary>
<p>You may ask why don't we just directly use <code>model.metadata.selection</code> inside
the registered function, instead of returning a function to make the command
parametric.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@register_function</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Count &#39;a&#39;&quot;</span><span class="p">,</span>
    <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="n">StandardType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">],</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">count_a</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">WidgetDataModel</span><span class="p">):</span>
    <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">selection</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">))</span>
</code></pre></div>
<p>A benefit of using a parametric function is that the function becomes reproducible.
When the function is re-executed from a workflow, the input text edit does not
necessarily in the same state as when the function was executed. In the example
above, the text selection range is not likely to be the same, so that you will get a
different result.</p>
<p>In general, all the information in the <code>metadata</code> property should not be directly
used in commands; they should always be passed as "bind" options.</p>
</details>
<hr />
<h2 id="preview-function-outputs">Preview Function Outputs</h2>
<p>In some cases, parameters should be tuned based on the output of the function. For
example in the case of the <code>format_json</code> function, the user may want to see the output
so that the json string looks good. To add a "preview" toggle button to the parameter
input window, just add the <code>preview</code> argument to the <code>configure_gui()</code> decorator.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@register_function</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Format JSON Text&quot;</span><span class="p">,</span>
    <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="n">StandardType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">],</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">format_json</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">WidgetDataModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Parametric</span><span class="p">:</span>
<span class="hll">    <span class="nd">@configure_gui</span><span class="p">(</span><span class="n">preview</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span>    <span class="k">def</span><span class="w"> </span><span class="nf">run_format_json</span><span class="p">(</span><span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">WidgetDataModel</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">run_format_json</span>
</code></pre></div>
<p><img alt="" loading="lazy" src="../../images/02_preview.gif" width="700px" /></p>
<hr />
<h2 id="asynchronous-execution">Asynchronous Execution</h2>
<p>It is also very easy to make your function asynchronous (make the application responsive
during the execution). Just add the <code>run_async=True</code> argument to the
<code>register_function()</code> decorator.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@register_function</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Format JSON Text&quot;</span><span class="p">,</span>
    <span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="n">StandardType</span><span class="o">.</span><span class="n">TEXT</span><span class="p">],</span>
<span class="hll">    <span class="n">run_async</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">format_json</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">WidgetDataModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Parametric</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_format_json</span><span class="p">(</span><span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">WidgetDataModel</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">run_format_json</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Do not update the GUI from an asynchronous function</p>
<p>You should not update the GUI from an asynchronous function, because it can only be
updated in the main thread.</p>
<div class="highlight"><span class="filename">This function crashes the application</span><pre><span></span><code><span class="nd">@register_function</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Add widget&quot;</span><span class="p">,</span>
    <span class="n">run_async</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_widget</span><span class="p">(</span><span class="n">ui</span><span class="p">:</span> <span class="n">MainWindow</span><span class="p">):</span>
    <span class="n">ui</span><span class="o">.</span><span class="n">add_widget</span><span class="p">(</span><span class="n">QtW</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Hello, world!&quot;</span><span class="p">))</span>
</code></pre></div>
</div>
<hr />
<h2 id="functions-that-only-works-in-a-specific-widget">Functions That Only Works in A Specific Widget</h2>
<p>If you know that the function only works in a specific widget <code>T</code>, you can use the
annotation <code>SubWindow[T]</code>. This command will only be enabled when the current sub-window
is built with the widget <code>T</code>.</p>
<p>For example, the following built-in plugin function only works for the <code>QImageView</code>
widget.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@register_function</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Scale bar ...&quot;</span><span class="p">,</span>
    <span class="o">...</span><span class="p">,</span>
<span class="p">)</span>
<span class="hll"><span class="k">def</span><span class="w"> </span><span class="nf">setup_image_scale_bar</span><span class="p">(</span><span class="n">win</span><span class="p">:</span> <span class="n">SubWindow</span><span class="p">[</span><span class="n">QImageView</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Parametric</span><span class="p">:</span>
</span>    <span class="o">...</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../io_provider/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Reader/Writer Functions">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Reader/Writer Functions
              </div>
            </div>
          </a>
        
        
          
          <a href="../register_widgets/" class="md-footer__link md-footer__link--next" aria-label="Next: Register Widgets">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Register Widgets
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright (c) 2024 - 2024 Hanjin Liu
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "navigation.sections", "navigation.indexes", "navigation.footer", "toc.follow", "search.suggest", "search.share"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.0.0/dist/mermaid.min.js"></script>
      
    
  </body>
</html>